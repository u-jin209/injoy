<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:fragment="headFragment">
<head>
    <title></title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
            integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"></script>

    <!-- alert 창-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
</head>
<body>
<header>
    <nav>
        <span>

<!-- Example single danger button -->
                <div class="btn-group">
                  <button type="button" class="btn" data-bs-toggle="dropdown" aria-expanded="false">
                    <img style="height: 27px; width: 27px;border-radius: 30%" th:src="@{${logIn.profilePhoto}}"
                         onerror=this.src='/img/user.jpg'>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="/user/userInfo">유저정보</a></li>

                    <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="#" onclick="withdrawal()">회원탈퇴</a></li>
                    <li><a class="dropdown-item" href="#" onclick="logout()">로그아웃</a></li>
                  </ul>
                </div>
            <!--            <img style="height: 27px; width: 27px;border-radius: 30%" th:src="${logIn.profilePhoto}" onerror=location.href='/img/user.jpg'  onclick="location.href='/user/userInfo'">-->
            <!--            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"-->
            <!--                 class="bi bi-person-circle"-->
            <!--                 viewBox="0 0 16 16" onclick="location.href='/user/userInfo'">-->
            <!--                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>-->
            <!--                <path fill-rule="evenodd"-->
            <!--                      d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>-->
            <!--            </svg>-->
        </span>
    </nav>
</header>


</body>
<script th:inline="javascript">
    const provider = /*[[ ${logIn.provider} ]]*/ ""

    function logout() {
        Swal.fire({
            text: '로그아웃 하시겠습니까?',

            showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
            confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
            cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
            cancelButtonText: '취소', // cancel 버튼 텍스트 지정
            confirmButtonText: '확인', // confirm 버튼 텍스트 지정

        }).then(result => {
            // 만약 Promise리턴을 받으면,
            if (result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면
                location.href = "/logout";
            }
        });
    }

    function withdrawal() {
        console.log(provider+'111111111111111111')
        if (provider == null) {
            Swal.fire({
                text: '회원탈퇴하시겠습니까?\n 비밀번호를 입력해주세요.',
                input: 'password',
                showCancelButton: true,
                confirmButtonText: '확인',
                cancelButtonText: '취소',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                preConfirm: (password) => {
                    if (!password) {
                        Swal.showValidationMessage('비밀번호를 입력해주세요.');
                    }
                    return password;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const password = result.value;
                    console.log(password)
                    $.ajax({
                        url: '/user/withdrawal',
                        method: 'POST',
                        data: {
                            password: password
                        },
                        success: function (response) {
                            if (response.flag === "success") {
                                Swal.fire({
                                    text: '회원탈퇴를 완료하였습니다.',
                                    confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                                    confirmButtonText: '확인', // confirm 버튼 텍스트 지정
                                }).then(() => {
                                    location.href = "/logout";
                                });
                            } else if (response.flag === "fail") {
                                Swal.fire({
                                    text: '회원탈퇴에 실패하였습니다.\n비밀번호를 다시 확인해주세요.',
                                    confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                                    confirmButtonText: '확인', // confirm 버튼 텍스트 지정
                                });
                            }
                        },
                        error: function (xhr, status, error) {
                            console.log(xhr)
                            console.log(status)
                            console.log(error)
                        }
                    })
                }
            });
        } else {
            Swal.fire({
                text: '회원탈퇴하시겠습니까?',
                showCancelButton: true,
                confirmButtonText: '확인',
                cancelButtonText: '취소',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/user/withdrawalSocial',
                        method: 'POST',
                        success: function (response) {
                            Swal.fire({
                                text: '회원탈퇴를 완료하였습니다.',
                                confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                                confirmButtonText: '확인', // confirm 버튼 텍스트 지정
                            }).then(() => {
                                location.href = "/logout";
                            });
                        },
                        error: function (xhr, status, error) {
                            console.log(xhr)
                            console.log(status)
                            console.log(error)
                        }
                    })
                }
            });
        }

    }
</script>
</html>
