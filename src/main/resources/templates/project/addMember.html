<!DOCTYPE html>

<html
        xmlns:th="http://www.thymeleaf.org" xmlns:lth="http://www.thymeleaf.org" lang="ko"
        th:fragment="addMemberContent(projectList, memberList, waitList)">
<head>
    <meta charset="utf-8">

    <title>YOU#</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />




    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
    <!-- 내 css  -->
    <link rel="stylesheet" href="/css/memberManagement.css">
</head>
<body>


<div class="container" style="content-align: center ;padding: 50px;background-color: #ffffff">
    <th:block th:fragment="${projectList}"></th:block>
    <h2 class="projectTitle" th:text="${projectList[0].projectName}"></h2>


    <h5 class="title"> 회원검색 </h5>
    <div class="row" style="justify-content: space-evenly;">
        <div class="search col-md-6">
            <input type="text" placeholder="검색어 입력">
            <img src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png">

        </div>

        <div class="col-md-2" style="text-align: center;">
            <button class="btn-orange" id="code" th:value="${projectList[0].invitationCode}" th:onclick="copyCode()">
                초대코드복사
            </button>
        </div>

    </div>


    <div id="searchResult" style="display: none">
        <h5 class="title"> 검색 결과 </h5>
        <div class="searchBack">
            <div class="row mt-5 mb-5" style="justify-content: center; ">
                <div class="col-md-6">
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="/img/moru.jpg" class="member" alt="...">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body" style="text-align: left">
                                    <h5 class="card-title">포테토</h5>
                                    <p class="card-text">모루카.</p>
                                    <div style="text-align: end">

                                        <button class="btn-blue">
                                            초대
                                        </button>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>


                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="/img/moru.jpg" class="member" alt="...">
                            </div>
                            <div class="col-md-8 mt-3">
                                <div class="card-body" style="text-align: left">
                                    <h5 class="card-title">포테토</h5>
                                    <p class="card-text">모루카.</p>
                                    <div style="text-align: end">

                                        <button class="btn-blue">
                                            초대
                                        </button>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-5">
                <button class="btn-orange">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
                         class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                        <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                    </svg>
                </button>
                <button class="btn-orange">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
                         class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                        <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                    </svg>
                </button>
            </div>

        </div>

    </div>
    <div>
        <h5 class="title"> 참여중인 회원 </h5>
        <div class="scrollDiv">
            <div class="row g-2" style="justify-content: center">
                <h1 th:fragment="${memberList}" ></h1>
                <div class="col-md-6" th:each=" member : ${memberList}" th:id="'user'+${member.userId}" name="member">
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row ">
                            <div class="col-md-4">
                                <img src="/img/moru.jpg" class="member" alt="...">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">


<!--                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"-->
<!--                                         viewBox="0 0 576 512" th:if="${member.authority.toString.equals('MANAGER')} ">-->
<!--                                        &lt;!&ndash;! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. &ndash;&gt;-->
<!--                                        <path d="M309 106c11.4-7 19-19.7 19-34c0-22.1-17.9-40-40-40s-40 17.9-40 40c0 14.4 7.6 27 19 34L209.7 220.6c-9.1 18.2-32.7 23.4-48.6 10.7L72 160c5-6.7 8-15 8-24c0-22.1-17.9-40-40-40S0 113.9 0 136s17.9 40 40 40c.2 0 .5 0 .7 0L86.4 427.4c5.5 30.4 32 52.6 63 52.6H426.6c30.9 0 57.4-22.1 63-52.6L535.3 176c.2 0 .5 0 .7 0c22.1 0 40-17.9 40-40s-17.9-40-40-40s-40 17.9-40 40c0 9 3 17.3 8 24l-89.1 71.3c-15.9 12.7-39.5 7.5-48.6-10.7L309 106z"/></svg>-->
<!--                                    </svg>-->


                                    <i class="fa-solid fa-crown" style="color: #ffb30d;" th:if="${member.authority.toString.equals('MANAGER')} "></i>
                                    <h5 class="card-title mt-1" th:text="${member.name}"></h5>
                                    <p class="card-text" th:text="${member}">모루카의 포테토</p>

                                    <button class="imgButton" th:onclick="|deleteUser(${member.userId},1)|"
                                            th:if="${!member.authority.toString.equals('MANAGER')}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             fill="#F5544D" class="bi bi-dash-square" viewBox="0 0 16 16">
                                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                            <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                                        </svg>
                                    </button>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="field"></div>


            </div>

        </div>


        <h5 class="title"> 참여대기 회원 </h5>
        <div class="scrollDiv">
            <div class="row g-2" style="justify-content: center">
                <h1 th:fragment="${waitList}"></h1>
                <div class="col-md-6"  th:each=" waitMember : ${waitList}" th:id="'user'+${waitMember.userId}" name="wait" >
                    <div class="card mb-3" style="max-width: 540px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="/img/moru.jpg" class="member" alt="...">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title" th:text="${waitMember.name}"></h5>
                                    <p class="card-text">This is a wider card with supporting text below as a
                                        natural lead-in to additional content. This content is a little bit
                                        longer.</p>

                                    <button class="imgButton" th:onclick="|deleteUser(${waitMember.userId},2)|">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             fill="#F5544D" class="bi bi-dash-square" viewBox="0 0 16 16">
                                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                            <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                                        </svg>
                                    </button>
                                    <div th:id="'plus'+${waitMember.userId}">
                                        <button class="imgButton"  th:onclick="|approveUser(${waitMember.userId}, ${waitMember.projectId})|">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                 fill="#266648" class="bi bi-plus-square" viewBox="0 0 16 16">
                                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                            </svg>
                                        </button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


</div>

<script type="text/javascript">
    /*<![CDATA[*/
    function copyCode() {

        const code = document.getElementById("code");
        window.navigator.clipboard.writeText(code.value).then(() => {
            // 복사가 완료되면 호출된다.
            Swal.fire({
                title: "초대코드 복사 완료",
                icon: "success"
            });
        });
    };

    function deleteUser(userId,option) {

        const data = {
            "userId": userId
        }

        if(option ==1){
            Swal.fire({

                title: '멤버를 삭제 하시겠습니까?',
                text: '확인을 누르면 삭제됩니다.',
                icon: 'warning',


                showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
                confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
                cancelButtonText: '취소', // cancel 버튼 텍스트 지정
                confirmButtonText: '삭제', // confirm 버튼 텍스트 지정

            }).then(result => {
                // 만약 Promise리턴을 받으면,
                if (result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면

                    $.ajax({
                        url: "/member/delete",
                        data: data,
                        type: "GET",
                    }).done(function () {

                        const userDiv = document.getElementById("user" + userId);

                        userDiv.remove();

                        Swal.fire({
                            title: "삭제되었습니다.",
                            icon: "success"
                        });
                    });
                }
            });
        }else if(option ==2 ){
            Swal.fire({

                title: '승인을 거절 하시겠습니까?',
                text: '확인을 누르면 거절됩니다.',
                icon: 'warning',


                showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
                confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
                cancelButtonText: '취소', // cancel 버튼 텍스트 지정
                confirmButtonText: '거절', // confirm 버튼 텍스트 지정

            }).then(result => {
                // 만약 Promise리턴을 받으면,
                if (result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면

                    $.ajax({
                        url: "/member/delete",
                        data: data,
                        type: "GET",
                    }).done(function () {

                        const userDiv = document.getElementById("user" + userId);

                        userDiv.remove();

                        Swal.fire({
                            title: "거절되었습니다.",
                            icon: "success"
                        });
                    });
                }
            });
        }




    };



    function approveUser(userId,projectId) {

        const data = {
            "userId": userId,
            "projectId": projectId
        }


        Swal.fire({
            title: '승인 하시겠습니까?',
            text: '확인을 누르면 승인됩니다.',
            icon: 'warning',

            showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
            confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
            cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
            cancelButtonText: '취소', // cancel 버튼 텍스트 지정
            confirmButtonText: '승인', // confirm 버튼 텍스트 지정

        }).then(result => {
            // 만약 Promise리턴을 받으면,
            if (result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면

                $.ajax({
                    url: "/member/approve",
                    data: data,
                    type: "GET",
                }).done(function () {

                    const waitDiv = document.getElementById("user" + userId);
                    const plusBtn = document.getElementById("plus"+userId);

                    plusBtn.style.display="none";


                    const newDiv = document.createElement('div').appendChild(waitDiv);

                    document.getElementById('field').appendChild(newDiv);



                    // waitDiv.remove();


                });
            }
        });


    };


    /*]]>*/

</script>


</body>

</html>
