<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>캘 린 더</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.0/main.min.css">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.5/index.global.min.js'></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!--    flatpickr-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!--    flatpickr 테만 변경 선택-->
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/material_blue.css"/>

    <!--    부트스트랩 -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyABN0ndYhxNu4zHlvEfKi_r42aSUMeVUaI&libraries=places"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyABN0ndYhxNu4zHlvEfKi_r42aSUMeVUaI&libraries=places" defer></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyABN0ndYhxNu4zHlvEfKi_r42aSUMeVUaI&libraries=places"></script>


    <style>
        #scheduleTitle {
            border: none;
            border-bottom: 1px solid rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 60px;
        }
        #scheduleTitle::placeholder {
            font-size: 20px;
            font-weight: bold;
        }
        /*.writeScheduleContent {*/
        /*    width: 434px;*/
        /*    min-height: 200px;*/
        /*    border: none;*/
        /*}*/
        #writeScheduleContent {
            border: 2px solid blue;
            resize: none;
            border-radius: 5px;
        }

        /*캘린더 이벤트 폰트 설정*/
        .fc-event {
            font-weight: bold;
        }


        /* Google autocomplete z-index css*/
        .pac-container {
            background-color: #FFF;
            z-index: 20;
            position: fixed;
            display: inline-block;
            float: left;
        }
        .modal{
            z-index: 20;
        }
        .modal-backdrop{
            z-index: 10;
        }



        /*여기서부터 옆 슬라이드 CSS*/
        .show-header-cart {
            visibility: visible;
            background-color: rgba(0, 0, 0, 0.6);
        }
        .show-header-cart .header-cart {
            right: 0;
        }
        .wrap-header-cart {
            position: fixed;
            z-index: 1100;
            width: 100%;
            height: 100vh;
            top: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.0);
            visibility: hidden;

            -webkit-transition: all 0.4s;
            -o-transition: all 0.4s;
            -moz-transition: all 0.4s;
            transition: all 0.4s;
        }
        .header-cart {
            position: fixed;
            z-index: 1100;
            /*width: 390px;*/
            /*width: 500px;*/
            width: 600px;
            max-width: calc(100% - 30px);
            height: 100vh;
            top: 0;
            right: -600px;
            background-color: #fff;

            -webkit-transition: all 0.4s;
            -o-transition: all 0.4s;
            -moz-transition: all 0.34s;
            transition: all 0.4s;

            box-shadow: 0 3px 6px 0px rgba(0, 0, 0, 0.18);
            -moz-box-shadow: 0 3px 6px 0px rgba(0, 0, 0, 0.18);
            -webkit-box-shadow: 0 3px 6px 0px rgba(0, 0, 0, 0.18);
            -o-box-shadow: 0 3px 6px 0px rgba(0, 0, 0, 0.18);
            -ms-box-shadow: 0 3px 6px 0px rgba(0, 0, 0, 0.18);
        }
        .header-cart::after {
            content: "";
            display: block;
            width: 100%;
            height: 9%;
            min-height: 30px;
        }
        .show-header-cart {
            visibility: visible;
            background-color: rgba(0, 0, 0, 0.6);
        }
        .show-header-cart .header-cart {
            right: 0;
        }




        .cal2 {
            display: inline-block;
            background-color: #FFF;
            width: 105px;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .cal2 {
            height: 30px;
            line-height: 30px;
            font-size: 0.75rem;
            text-transform: uppercase;
            background-color: #FFF;
            color: #00B19c;
            font-weight: 800;
        }

        .cal2 .date2 {
            font-size: rem;
            font-weight: bold;
            color: black;
            line-height: 30px;
            background-color:#eeeeee;
        }

        .date2 {
            border-radius: 5px;
        }


        /*google map img size*/
        #mapImage {
            width: 514px;
            height: 185px;
            border-radius: 15px;
        }


        /*캘린더 사이즈*/
        #calendarBox{
            width: 80%;
            height: 80%;
        }
    </style>

</head>
<body>
<h1>Hello World from C h e r r y</h1>

<div id="calendarBox">
    <div id='calendar'></div>
</div>


<!--<p th:text="${tmp}"></p>-->

<!--  일정 등록하기-->
<!--<div class="modal" id="addScheduleModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">-->
<!--    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">-->
<div class="modal" id="addScheduleModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="addTaskModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg " style="width: 580px;">
        <div class="modal-content p-3">
            <div class="modal-header">
                            <span class="modal-title mr-2" id="addTaskModalLabel" style="font-weight: 900">
                                일정 작성 |
                            </span>
                    <div style="width: 15px; height: 15px; border-radius: 4px; background-color: blue;"></div>
                <div style="padding-left: 8px; font-size: 14px;"><span>프로젝트명</span></div>


                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        onclick="closeModal()"></button>
            </div>


<!--            <form name="frm" action="/watermelon" method="get">-->
            <form name="frm" id="frm" method="post" >
                <div class="modal-body text-start">
                    <div>
                        <input id="scheduleTitle" name="scheduleTitle" placeholder="제목을 입력하세요" style=""/>
                        <label for="scheduleTitle"></label>
                    </div>
                    <div>
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                 class="bi bi-calendar-check mr-3" viewBox="0 0 16 16">
                                <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                            </svg>
                            <label>

                                <input class="mr-2 scheduleStartDate startCalDate"
                                       style="border: none; border-bottom: 1px solid #777777; font-weight: 900" name="startDate" id="startDate"
                                       value=""/>
                            </label>
                            ㅡ
                            <label>
                                <input class="ml-2 scheduleEndDate endCalDate"
                                       style="border: none; border-bottom: 1px solid #777777; font-weight: 900" name="endDate" id="endDate"
                                       value=""/>
                            </label>
                        </div>
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-person mr-3" viewBox="0 0 16 16">
                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
                            </svg>

                            <span>
                                <div class="cal2">
                                    <div class="date2" style="display: flex;">
                                        <div>
                                            <img src="/img/penguin.jpg"
                                                 style="width: 25px; height: 25px; margin-left: 2px; border-radius: 5px">
                                        </div>
                                        <div style="padding-left: 4px;">닉네임을 넣</div>
                                    </div>
                                </div>
                            </span>

                        </div>

                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-geo-alt-fill mr-3" viewBox="0 0 16 16">
                                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                            </svg>

                                <label>
                                    <input type="text" id="addressInputId" value="" onkeyup="if(window.event.keyCode==13){codeAddress()}" placeholder="입력후 Enter를 입력주세요." size=45 style="border: none"/>
                                </label>

                                <div id="imgDiv">
<!--                                    <img id="mapImage" src="" alt="static map" style="width: 514px; height: 185px; visibility: hidden; border-radius: 15px;">-->
                                </div>

                        </div>

                        <div class="mb-5" style="display: flex; flex-direction: row">
                            <div style="height: 100%">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                     class="bi bi-clipboard2-check mr-3" viewBox="0 0 16 16">
                                    <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
                                    <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
                                    <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z"/>
                                </svg>
                            </div>
                            <label>
<!--                                <input class="writeScheduleContent" placeholder="내용을 입력하세요." style="border: none;"/>-->
                                <textarea id="writeScheduleContent" rows="11" cols="60" placeholder="내용을 입력하세요."  style="border: none;"></textarea>
                            </label>
                        </div>



                    </div>

                </div>
                <div class="modal-footer" style="justify-content: end !important;">
<!--                                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"-->
<!--                                           class="bi bi-paperclip" viewBox="0 0 16 16">-->
<!--                                          <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>-->
<!--                                      </svg>-->
<!--                                          <button type="button" class="btn taskAddButton"-->
                    <button type="submit" class="btn taskAddButton"
                            style="background-color: #001542; color: white" id="submitShedule">등록
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>




<!--  사이드 슬라이드  HTML -->
<div class="wrap-header-cart js-show-schedule">
    <div class="s-full js-hide-cart"></div>

    <div class="header-cart flex-col-l p-l-65 p-r-25">
        <div class="header-cart-title flex-w flex-sb-m p-b-8">
				<span class="mtext-103 cl2">
<!--					여기에 내용을 넣어주세용~-->
				</span>

            <div class="trans-04 js-hide-cart">
                <!--                  <div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">-->
                <!--                      <i class="zmdi zmdi-close"></i>-->
                <!--                  </div>-->
                <div style="width: 100%;display: flex;justify-content: end">
                    <div type="button" class="btn-close" aria-label="Close" onclick="closeTab()"></div>
                </div>
            </div>

            H e l l o W o r l d
        </div>
    </div>
</div>



<!--        입력창         -->
<script>
    const textarea = document.getElementById("writeScheduleContent");
    textarea.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            const currentValue = this.value;
            this.value = currentValue + "\n";
        }
    });
</script>


<!-- Form enter 전송 막기-->
<script>
    document.addEventListener('keydown', function(event) {
        if (event.keyCode === 13) {
            event.preventDefault();
        };
    }, true);
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        $(function () {
            var request = $.ajax({

                url: "/logic", // URL 새로운거로 다시 넣어주기. 일정 뿌려주기
                method: "GET",
                dataType: "json"
            });

            request.done(function (data) {
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    themeSystem: 'bootstrap5',
                    initialView: 'dayGridMonth',
                    locale: 'ko',
                    editable: false,
                    selectable: true,//드래그로 선택 가능...
                    headerToolbar: { //Tool Bar
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                    },

                    // dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
                    // expandRows: true, // 화면에 맞게 높이 재설정

                    allDay: false,
                    select: function (arg) { // 캘린더에서 드래그로 이벤트를 생성할 수 있다.
                        $('#addScheduleModal').show();
                        setDateTime(arg);

                        calendar.unselect(); //이건 뭘까...
                    },

                    // eventColor : '#378006', //이벤트 디폴트 색상 정해줌.

                    events: data,

                    eventClick: function (event) {//이벤트 클릭 시
                        // alert("이벤트가 발생이 됩니당~");
                        var Obj = event.event;
                        console.log("제목 : " + Obj.title);
                        console.log("시작일 : " + Obj.start);
                        console.log("끝 : " + Obj.end);

                        $('.js-show-schedule').addClass('show-header-cart');
                    },


                });

                calendar.render();

            });

            request.fail(function (jqXHR, textStatus) {
                alert("Request failed : " + textStatus);
            });


        });

    }); /////////////////////////////// E N D ///////////////////////////////



    function closeModal() {
        $('#addScheduleModal').hide();
        $('#frm')[0].reset();
        document.getElementById("mapImage").remove();

    }

    var fpStart = flatpickr(".startCalDate", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
    });
    var fpEnd = flatpickr(".endCalDate", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
    });

    function setDateTime(arg) {//일정 드래그 후, start end에 값 세팅하는 메서드
        var end = new Date(new Date(arg.endStr).getTime() - 86400000);
        var endDate = dateFormat(end).toString();

        var start = new Date(arg.startStr);
        var startDate = dateFormat(start).toString();
        fpStart.setDate(startDate);
        fpEnd.setDate(endDate);
    }

    function dateFormat(date) {//yyyy-mm-dd 00:00(현재시간) 형식으로 반환하는 메서드
        let month = date.getMonth() + 1;
        let day = date.getDate();

        month = month >= 10 ? month : '0' + month;
        day = day >= 10 ? day : '0' + day;

        var today = new Date();
        var hours = ('0' + today.getHours()).slice(-2);
        var minutes = ('0' + today.getMinutes()).slice(-2);

        return date.getFullYear() + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
    }

    // 사이드 스케줄
    function closeTab() {
        $('.js-show-schedule').removeClass('show-header-cart');
    }



    $(function(){
        $('#submitShedule').on("click",function () {

            // var form1 = $("#frm").serialize();
            var form1 = $("#frm").serializeObject();

            console.log("폼입니다 : " + form1);
            console.log("폼입니다 : " + form1.scheduleTitle);
            console.log("폼입니다 : " + form1.endDate);

            $.ajax({
                type: "post",
                url: "/receive",
                data: form1,
                dataType: 'json',
                success: function (data) {
                    alert("success");
                    console.log(data);
                },
                error: function (request, status, error) {
                    console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);

                }
            });
        });
    });


    jQuery.fn.serializeObject = function() {//form.serialize -> json형식으로 변환해주는 메서드
        var obj = null;
        try {
            if (this[0].tagName && this[0].tagName.toUpperCase() == "FORM") {
                var arr = this.serializeArray();
                if (arr) {
                    obj = {};
                    jQuery.each(arr, function() {
                        obj[this.name] = this.value;
                    });
                }
            }
        } catch (e) {
            alert(e.message);
        }
        return obj;
    };
</script>



<!--            google map api          -->
<script>
    $('#addressInputId').on("input", function() {
        var val = $('#addressInputId').val().trim();
        console.log("값 : " + val.trim() );

        if(val == ""){
            console.log("Empty String");
            // document.getElementById("mapImage").style.visibility='hidden';
            document.getElementById("mapImage").remove();
        } else {
            getPlace();
        }

        function getPlace(){
            console.log("getPlace method ")
            const input = document.getElementById("addressInputId");
            const options = {
                //add options here if you want more customizations
            };
            const autocomplete = new google.maps.places.Autocomplete(input, options);

        }

    });
    window.addEventListener('load', getPlace);


    function codeAddress() {
        var imgTag = document.createElement('img');
        imgTag.id = "mapImage";
        imgTag.src = "";
        imgTag.alt = "static img";
        imgTag.style = "visibility: hidden";
        document.getElementById("imgDiv").append(imgTag);

        var geocoder;
        var map;
        geocoder = new google.maps.Geocoder();
        var address = document.getElementById('addressInputId').value;
        console.log("주소 : " + address);
        geocoder.geocode( { 'address': address}, function(results, status) {


            if (status == 'OK') {
                console.log('this is OK');
                // var tmp = (results[0].geometry.location).toString();

                console.log("위도 : " + results[0].geometry.location.lat());
                console.log("경도 : " + results[0].geometry.location.lng());

                const apiKey = 'AIzaSyABN0ndYhxNu4zHlvEfKi_r42aSUMeVUaI';

                const latitude = results[0].geometry.location.lat()
                const longitude = results[0].geometry.location.lng()

                // Set the map center and other parameters
                const mapCenter = `center=${latitude},${longitude}`;
                const mapZoom = 'zoom=14'; // Optional: Specify the zoom level

                const mapMarkers = `markers=color:red%7Clabel:%7C${latitude}, ${longitude}`;

                const imageUrl = `https://maps.googleapis.com/maps/api/staticmap?${mapCenter}&${mapZoom}&size=646x220&${mapMarkers}&key=${apiKey}`;

                // Set the image source to the constructed URL
                const mapImage = document.getElementById('mapImage');
                mapImage.src = imageUrl;
                document.getElementById("mapImage").style.visibility='visible';

                var ads = addressLogic(latitude, longitude);
                console.log(addressLogic(latitude, longitude))
                console.log("ads : " + ads );


            } else {
                console.log("this is an !ERROR!" + status);
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }


    function addressLogic(latitude, longitude) {//return Address from latitude and longitude method
        const geocoder = new google.maps.Geocoder();
        const latlng = {
            lat: parseFloat(latitude),
            lng: parseFloat(longitude),
        };

        var address;

        geocoder
            .geocode({ location: latlng })
            .then((response) => {
                console.log("헬로우 : " + response.results[0].formatted_address);
                tmp = response.results[0].formatted_address
                console.log("tmp : " + tmp)

                if (response.results[0]) {
                    address = response.results[0].formatted_address;
                    getAddress(address);
                } else {
                    return "ERROR";
                }
            })
    }

    function getAddress(address){ // (4) should log the address
        console.log("Finally : " + address);
        document.getElementById("addressInputId").value = address
    }


</script>

</body>
</html>