<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" >

<div th:fragment="calendarContent(project, login)">

    <div id='calendar'></div>

<input type="hidden" id="projectNameName" th:value="${project.projectName}">
<input type="hidden" id="projectIdId" th:value="${project.projectId}">
<input type="hidden" id="logInnn" th:value="${login.userId}">
<input type="hidden" id="logInnname" th:value="${login.name}">


<!-- Modal -->
<div class="modal " id="addScheduleModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title mr-2" id="addTaskModalLabel" style="font-weight: 900">
                                일정 작성 |
                            </span>
                <div style="padding-left: 8px; font-size: 14px;"><span>프로젝트명</span></div>
                <button type="button" class="btn-close"  data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button>
            </div>
            <form name="calendarForm" id="calendarForm" method="post">
                <div class="modal-body text-start">
                    <input class="ml-2 "
                           style="display: none"
                           name="projectId" id="projectId"
                           th:value="${project.projectId}"/>
                    <div>
                        <input id="scheduleTitle" name="scheduleTitle" placeholder="제목을 입력하세요" />
                        <label for="scheduleTitle"></label>
                    </div>
                    <div>
                        <div class="row mb-3">

                            <div class="col-md-1" style="  align-self: center;">

                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                     class="bi bi-calendar-check mr-3" viewBox="0 0 16 16">
                                    <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                </svg>
                            </div>

                            <div class="col-md-5">
                                <label>

                                    <input class="mr-2 scheduleStartDate startCalDate"
                                           style="border: none; border-bottom: 1px solid #777777; font-weight: 900"
                                           name="startDate" id="startDate"
                                           value=""/>
                                </label>
                            </div>
                            <div class="col-md-1" style="    align-self: center;margin: inherit;">

                            ㅡ
                            </div>
                            <div class="col-md-5">
                            <label>
                                <input class="ml-2 scheduleEndDate endCalDate"
                                       style="border: none; border-bottom: 1px solid #777777; font-weight: 900"
                                       name="endDate" id="endDate"
                                       value=""/>
                            </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-person mr-3" viewBox="0 0 16 16">
                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
                            </svg>

                            <span>
                                <div class="cal2">
                                    <div class="date2" style="display: flex;">
                                        <div>
                                            <img src="/img/penguin.jpg"
                                                 style="width: 25px; height: 25px; margin-left: 2px; border-radius: 5px">
                                        </div>
                                        <div style="padding-left: 4px;" th:text="${login.name}">닉네임을 넣아라</div>
                                    </div>
                                </div>
                            </span>

                        </div>

                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-geo-alt-fill mr-3" viewBox="0 0 16 16">
                                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                            </svg>

                            <label>
                                <input type="text" id="addressInputId" name="addressInputId" value=""
                                       onkeyup="if(window.event.keyCode==13){enterAddress('register')}"
                                       placeholder="입력후 Enter를 입력주세요." size=45 style="border: none"/>
                            </label>

                            <div id="imgDiv" style="display: none;">
<!--                                <img id="mapImagee" src="" alt="static map" style="width: 514px; height: 185px; visibility: hidden; border-radius: 15px;">-->
                                <img id="mapImagee" src="" alt="static map">
                            </div>

                        </div>

                        <div class="mb-5" style="display: flex; flex-direction: row; margin-bottom: 0!important;">
                            <div style="height: 100%">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                     class="bi bi-clipboard2-check mr-3" viewBox="0 0 16 16">
                                    <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
                                    <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
                                    <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z"/>
                                </svg>
                            </div>
                            <label>

                                <!--                                <input class="writeScheduleContent" placeholder="내용을 입력하세요." style="border: none;"/>-->
                                <textarea id="writeScheduleContent" name="writeScheduleContent" rows="9" cols="55"
                                          placeholder="내용을 입력하세요." style="border: none; width: 430px"></textarea>
                            </label>
                        </div>


                    </div>
                </div>
                <div class="modal-footer" style="justify-content: end !important;">

                    <button type="button" class="btn taskAddButton"
                            style="background-color: #001542; color: white" id="submitCalSchedule" name="submitCalSchedule">등록
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>



<!--  사이드 슬라이드  HTML -->
<div class="wrap-header-cart js-show-schedule">
    <div class="s-full js-hide-cart"></div>

    <div class="header-cart flex-col-l p-l-65 p-r-25" id="tlqkf" style="overflow: scroll;">

        <div class="header-cart-title flex-w flex-sb-m p-b-8">

            <div class="modal-header p-2">

                <div class="col-0.5">
                    <div style="margin-top: 6px; width: 15px; height: 15px; border-radius: 4px; background-color: #E6E6E6; margin-left: 10px"></div>
                </div>

                <div class="col-10" style="padding: 0;margin-right: 33px">
                    <input id="calendarIdId" th:value="${calendarId}" type="hidden" placeholder="캘린더 아이디">
                    <span id="calProjectName" style="font-size: 12px" th:text="${projectName}">프로젝트 이름 </span>
                </div>

                <div class="trans-04 js-hide-cart col-1.5">
                    <div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">
                        <div type="button" class="btn-close" aria-label="Close" onclick="closeTab()"></div>
                    </div>
                </div>

            </div>

        </div>


        <div class="modal-body" style="padding: 10px; ">

            <div class="m-3" style="display: flex;">

                <div class="col-10" style="display: flex; padding: 0;">
                    <!--                    <span>프사</span>-->
                    <div class="user-profile-thumbnail">
                        <span class="thumbnail size40 radius16" style="background-image: url(/img/penguin.jpg)"></span>
                    </div>

                    <div class="m-2" style="display: flex;">
                        <div style="font-size: 14px;"><strong th:text="${usernamee}">닉네임</strong></div>
                        <div style="font-size: 14px; color: #AAAAAA" th:text="${calRegister_date}">작성날짜</div>
                    </div>

                </div>

                <div class="col-2" style="display: flex; padding: 0;">
                    <a href="" style="font-size: 12px; font-weight: bolder; padding: 0;" class="col-10">게시글 보기 </a>
                    <!--          <div>구냥</div>-->
                    <div class="col-2">
                        <div class="dropdown">
                            <a class="bi bi-three-dots-vertical" type="button" id="dropdownMenuButton1"
                               data-bs-toggle="dropdown" aria-expanded="false" th:onclick="showDelnMod([[${writerId}]]);"></a>

                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" >
                                <li id="modScheduleLi"><a class="dropdown-item" onclick="openModifySchedule()" ><i class="bi bi-card-text"></i>수정</a></li>
                                <li><a class="dropdown-item" href="#" onclick="method()"><i class="bi bi-files"></i> 링크 복사</a></li>
                                <li id="delScheduleLi"><a class="dropdown-item" th:onclick="deleteScheduleMethod([[${projectId}]],[[${calendarId}]]);"><i class="bi bi-trash3"></i> 삭제</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>


            <div class="m-3" style="display: flex;">
                <div class="col-2 m-1" style="padding: 0; ">
                    <div class="cal">
                        <div class="month" th:text="${yearAndMonth}">2023-12</div>
                        <div class="date" th:text="${month}">27</div>
                    </div>
                </div>

                <div class=" col-10 m-2">
                    <div id="slideCalTitle" th:text="${calTitle}" style="font-size: 20px; font-weight: bolder;">
                        일정 이름
                    </div>


                    <!--                    <div class="" style="display: flex;">2023-05-16 (화), 12:40 2023-05-18 (목), 13:40</div>-->
                    <div class="" style="display: flex;">
                        <div th:text="${calStart}" id="startDateShow"></div>
                        <pre> ㅡ </pre>
<!--                        <div th:text="${#dates.format(calEnd, 'yyyy-MM-dd HH:mm:ss')}" id="endDateShow"></div>-->
                        <div th:text="${calEnd}" id="endDateShow"></div>
                    </div>
                </div>
            </div>


            <hr>  <!--      선-->

            <div th:style="${calAddress != '' ? 'display:block' : 'display:none'}">
                <div style="display: flex;">
                    <div class="col-1">
<!--                        <br>-->
                        <i class="bi bi-geo-alt"></i>
                    </div>
                    <div class="col-11">
<!--                        <br>-->

                        <div id="calAddressId" th:text="${calAddress}">
                            위치 주소가 들어갑니다.
                        </div>
<!--                        <br>-->
                    </div>
                </div>

                <div th:style="${calImgSrc == '' ? 'display:none' : 'display:block'}">
                    <div style="display: flex;">
                        <div class="col-1"></div>
                        <div class="col-11">
                            <img id="calImgSrcId" th:src="${calImgSrc}" alt="위치이미지" style="height: 100%; width: 100%; border-radius: 15px;">
                            <!--                            <img th:src="${calImgSrc}" alt="위치이미지" style="display: none" />-->
                        </div>
                    </div>
                </div>

            </div>



            <div style="display: flex;">
                <div class="col-1">
                    <br>
                    <i class="bi bi-card-text"></i>
                </div>
                <div class="col-11">
                    <br>

                        <div th:text="${calContent}" id="calRegisterId">
                            여기는 내용이 들어갑니다.
                        </div>
                    <br>


                </div>
            </div>
        </div>


<!--        <div>아 여기에 댓글 총 갯수</div>-->
        <!--        <hr class="" style="color: rgb(126,125,125);  height: 0.9px;">-->

<!--        <div style="background-color: #eee" id="comment_list_div">-->
        <div  style="background-color: #eee" >
            <hr class="" style="color: rgb(126,125,125);  height: 0.9px;">

            <div id="comment_list_div">
                <ul id="comment_list_ul" style="list-style:none; padding: 0;"></ul>
            </div>

            <ul class="comment_list" id="comment_list" style="list-style:none; padding: 0;" th:each="comment : ${commentList}"></ul>

            <div class="comment-input-wrap" style="background-color: #eee">
                <div class="user-profile-thumbnail">
                    <span class="thumbnail size40 radius16" style="background-image: url(/img/penguin.jpg)"></span>
                </div>

                <div class="comment-container" style="padding: 0;">
                    <input type="text" class="commentInput" id="post_comment_input"
                           placeholder="댓글을 입력은 Enter 입니다." value=""
                           aria-label="Recipient's username" aria-describedby="button-addon2"
                           onkeyup="if( window.event.keyCode==13){sendComment()}"/>
                </div>
            </div>
        </div>

    </div>
</div>



<!--            수정          -->
<div class="modal" id="modifyScheduleModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="modifyTaskModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg " style="width: 580px;">
        <div class="modal-content p-3">
            <div class="modal-header">
                <span class="modal-title mr-2" id="modifyTaskModalLabel" style="font-weight: 900">
                                일정 작성 |
                            </span>
                <div style="width: 15px; height: 15px; border-radius: 4px; background-color: blue;"></div>
                <div style="padding-left: 8px; font-size: 14px;"><span>프로젝트명</span></div>

                <input id="slideCalendarIdId" value="" placeholder="캘린더 아이디" type="hidden">

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        onclick="closeModifyModal()"></button>
            </div>


            <form name="modifyCalendarForm" id="modifyCalendarForm" method="post">
                <div class="modal-body text-start">
                    <div>
                        <input id="modifyScheduleTitle" name="modifyScheduleTitle" placeholder="제목을 입력해주세요"/>
                        <label for="modifyScheduleTitle"></label>
                    </div>

                    <div>
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                 class="bi bi-calendar-check mr-3" viewBox="0 0 16 16">
                                <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                            </svg>
                            <label>

                                <input class="mr-2 modifyScheduleStartDate modifyStartCalDate"
                                       style="border: none; border-bottom: 1px solid #777777; font-weight: 900"
                                       name="modifyStartDate" id="modifyStartDate"
                                       value="" />
                            </label>
                            ㅡ
                            <label>
                                <input class="ml-2 modifyScheduleEndDate modifyEndCalDate"
                                       style="border: none; border-bottom: 1px solid #777777; font-weight: 900"
                                       name="modifyEndDate" id="modifyEndDate"
                                       value="" />
                            </label>
                        </div>

                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-person mr-3" viewBox="0 0 16 16">
                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
                            </svg>

                            <span>
                                <div class="cal2">
                                    <div class="date2" style="display: flex;">
                                        <div>
                                            <img src="/img/penguin.jpg"
                                                 style="width: 25px; height: 25px; margin-left: 2px; border-radius: 5px">
                                        </div>
                                        <div style="padding-left: 4px;" th:text="${login.name}">닉네임을 넣</div>
                                    </div>
                                </div>
                            </span>
                        </div>

                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                 class="bi bi-geo-alt-fill mr-3" viewBox="0 0 16 16">
                                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                            </svg>

                            <label>
                                <input type="text" id="modifyAddressInputId" value=""
                                       onkeyup="if(window.event.keyCode==13){enterAddress('modify')}"
                                       placeholder="입력후 Enter를 입력주세요." size=45 style="border: none"/>
                            </label>

                            <div id="modifyImgDiv" style="display: none;">
                                <img id="mapImageeM" src="" alt="static map">
                            </div>
                        </div>

                        <div class="mb-5" style="display: flex; flex-direction: row; margin-bottom: 0!important;">
                            <div style="height: 100%">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                     class="bi bi-clipboard2-check mr-3" viewBox="0 0 16 16">
                                    <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
                                    <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
                                    <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z"/>
                                </svg>
                            </div>
                            <label>

                                <!--                                <input class="writeScheduleContent" placeholder="내용을 입력하세요." style="border: none;"/>-->
                                <textarea id="modifyWriteScheduleContent" name="modifyWriteScheduleContent" rows="9" cols="55"
                                          placeholder="내용을 입력하세요." style="border: none;"></textarea>
                            </label>
                        </div>

                    </div>



                </div>
                <div class="modal-footer" style="justify-content: end !important;">
                    <!--                                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"-->
                    <!--                                           class="bi bi-paperclip" viewBox="0 0 16 16">-->
                    <!--                                          <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>-->
                    <!--                                      </svg>-->
                    <!--                                          <button type="button" class="btn taskAddButton"-->

                    <!--                    <button type="submit" class="btn taskAddButton"-->
                    <button type="button" class="btn taskAddButton"
                            style="background-color: #001542; color: white" id="modifySubmitCalShedule" name="modifySubmitCalShedule">등록
                    </button>


                </div>

            </form>

        </div>
    </div>
</div>


<script>


    function showDelnMod(writerId) {
        currentId = document.getElementById("logInnn").value;
        // console.log("writerId : " + writerId);
        // console.log("currentId : " + currentId);
        if(currentId != writerId){
            document.getElementById("modScheduleLi").style.display ='none';
            document.getElementById("delScheduleLi").style.display ='none';
        } else {
            document.getElementById("modScheduleLi").style.display ='block';
            document.getElementById("delScheduleLi").style.display ='block';
        }
    }

    function deleteScheduleMethod(projectId, scheduleId){
        console.log("삭제 캘린더 번호  " + scheduleId);
        let data = {"projectId" : projectId,
            "scheduleId" : scheduleId
        };
        $.ajax({
            url: "/deleteSchedule",
            type: "POST",
            data: data,
            success: function () {
                location.reload();
            },
            error: function (request, status, error) {
                console.log("통신 실패");
                console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);
            }
        });

    }

    function closeModifyModal(){
        $('#modifyScheduleModal').hide();
        document.getElementById("addressInputId").value = "";
    }

    function openModifySchedule(){
        closeTab();

        var calIdId = document.getElementById("calendarIdId").value;
        document.getElementById("slideCalendarIdId").value = calIdId;


        var startDate = document.getElementById('startDateShow').innerHTML;
        var endDate = document.getElementById("endDateShow").innerHTML;

        var fpStart = flatpickr(".modifyStartCalDate", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: startDate
        });
        var fpEnd = flatpickr(".modifyEndCalDate", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: endDate
        });

        document.getElementById("modifyScheduleTitle").value = document.getElementById("slideCalTitle").innerHTML;

        var calAddressDiv = document.getElementById("calAddressId").innerHTML;
        if(calAddressDiv != '') {
            var addressInputId = document.getElementById("modifyAddressInputId");
            addressInputId.value = calAddressDiv;

            var calImgSrcId = document.getElementById("calImgSrcId");
                var calImgSrcStr = calImgSrcId.src.toString();
                var isNon = calImgSrcStr.substring(calImgSrcStr.length-3, calImgSrcStr.length);


                if(isNon != 'non'){
                    // codeAddress();
                    // codeAddress('modify');
                    enterAddress('modify');
                }

        }

        document.getElementById("modifyWriteScheduleContent").value = document.getElementById("calRegisterId").innerHTML;



        $('#modifyScheduleModal').show();


        // $.ajax({
        //     url: "/modifySchedule",
        //     type: "POST",
        //     data: ,
        //     success: function () {
        //         location.reload();
        //     },
        //     error: function (request, status, error) {
        //         console.log("통신 실패");
        //         console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);
        //     }
        // });
    }
</script>
<!---->

<!--<script th:inline="javascript">-->
<!--    console.log([[${project}]]);-->
<!--</script>-->

<!--        입력창         -->
<script th:inline="javascript">

    console.log([[${project}]]);

    const textarea = document.getElementById("writeScheduleContent");
    textarea.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            const currentValue = this.value;
            this.value = currentValue + "\n";
        }
    });
</script>


<!--&lt;!&ndash; Form enter 전송 막기&ndash;&gt;-->
<!--<script>-->
<!--    document.addEventListener('keydown', function (event) {-->
<!--        if (event.keyCode === 13) {-->
<!--            event.preventDefault();-->
<!--        }-->
<!--        ;-->
<!--    }, true);-->
<!--</script>-->



<script>
    var calendarObj;
    var Obj;

    document.addEventListener('DOMContentLoaded', function () {
        $(function () {
            var calendarEll = document.getElementById('calendar');
            var calendarr = new FullCalendar.Calendar(calendarEll, {});

            let data = {
                "activeStart": calendarr.view.activeStart,
                "activeEnd": calendarr.view.activeEnd,
                "projectId" : $('#projectIdId').val()
            }
            console.log("activeStart : " + calendarr.view.activeStart);
            console.log("activeEnd : " + calendarr.view.activeEnd);

            var request = $.ajax({

                url: "/loadSchedule", // URL 새로운거로 다시 넣어주기. 일정 뿌려주기
                method: "GET",
                dataType: "json",
                data: data
            });

            request.done(function (data) {
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    themeSystem: 'bootstrap5',
                    initialView: 'dayGridMonth',
                    locale: 'ko',
                    editable: false,
                    selectable: true,//드래그로 선택 가능...
                    headerToolbar: { //Tool Bar
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                    },

                    // dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
                    // expandRows: true, // 화면에 맞게 높이 재설정

                    // allDay: false,
                    select: function (arg) { // 캘린더에서 드래그로 이벤트를 생성할 수 있다.
                        $('#addScheduleModal').show();
                        setDateTime(arg);

                        calendar.unselect(); //이건 뭘까...
                    },

                    // eventColor : '#378006', //이벤트 디폴트 색상 정해줌.

                    events: data,

                    eventClick: function (event) {//이벤트 클릭 시

                        Obj = event.event;
                        console.log("calendarId : " + Obj.id);
                        console.log("제목 : " + Obj.title);
                        console.log("시작일 : " + Obj.start);
                        console.log("끝 : " + Obj.end);

                        const projectName = document.getElementById('projectNameName').value;
                        console.log("프로젝트 이름 : " + projectName);

                        const projectIdId = document.getElementById('projectIdId').value;

                        const loginUserId = document.getElementById("logInnn").value;

                        let dataa = {
                            "calendarId": Obj.id,
                            "projectName": projectName,
                            "projectIdId": projectIdId,
                            "loginUserId" : loginUserId

                        }
                        $.ajax({
                            url: "/testtt",
                            type: "POST",
                            data: dataa,
                        }).done(function (fragment) {
                            console.log("frag: " + fragment);
                            $("#tlqkf").replaceWith(fragment);
                        });

                        var userId = dataa.loginUserId;
                        console.log("현재 로그인 : " + userId);
                        $.ajax({
                            url: "/showCalComment",
                            type: "POST",
                            data: dataa,
                            success: function (result) {
                                // var ul = document.createElement('ul');
                                var ul = document.getElementById("comment_list_ul");
                                // ul.id = "comment_list_ul"
                                // ul.style.cssText = "list-style:none; padding: 0;";

                                // console.log($("#comment_list_div"));

                                result.forEach(function (comment) {

                                    if(userId == comment.calComUserId) {
                                        $(ul).append(
                                            "<li id='" + comment.calCommentId + "'>" +
                                            "<div style='display: flex;' class='m-3'>" +
                                            "<div class='col-1' id='col"+comment.calCommentId+"' style='width: 100%;'>" +
                                            "<span class='thumbnail size40 radius16' style='background-image: url(/img/penguin.jpg)'>" +
                                            "</span></div>" +
                                            "<div class='col-11' id='comment"+comment.calCommentId+"'>" +
                                            "<div id='tmptmp"+comment.calCommentId+"'>" +
                                            "<div style='display: flex; justify-content: space-between'>" +

                                            "<div style='display: flex; flex-direction: row'>" +
                                            "<div style='margin-right: 10px;'>" +
                                            "<strong>" + comment.calComUsername + "</strong>" +
                                            "</div>" +
                                            "<div class='' style='font-size: 14px; padding-top: 3px; color: #AAAAAA;'>"+ comment.calComRegisterDateStr +"</div>" +
                                            "</div>" +

                                            "<div id='commentDelnModi'>" +
                                            "<div class='' style='margin-right: 5px'>" +
                                            "<a class='bi bi-pencil-square' type='button' style='color: #AAAAAA;' onClick='modifyCalComment(" + comment.calCommentId + ","+ comment.calComProjectId + ","+ comment.calComCalId +")'></a>" +
                                            "</div>" +
                                            "<div class=''>" +
                                            "<a class='bi bi-trash3' type='button' style='color: #AAAAAA;' onclick='deleteCalComment(" + comment.calCommentId + ","+ comment.calComProjectId + ","+ comment.calComCalId +")'></a>" +
                                            "</div>" +
                                            "</div>" +



                                            "</div>" +

                                            "<div id='cmtcmt"+comment.calCommentId+"' style='padding-top: 8px; font-size: 15px;'>" + comment.calComContent + "</div>" +
                                            "</div>" +
                                            "</div>" +
                                            "</div>" +

                                            "<hr style='color: rgb(126,125,125);'>" +
                                            "</li>");
                                    } else {
                                        $(ul).append(
                                            "<li id='" + comment.calCommentId + "'>" +
                                            "<div style='display: flex;' class='m-3'>" +
                                            "<div class='col-1'>" +
                                            "<span class='thumbnail size40 radius16' style='background-image: url(/img/penguin.jpg)'>" +
                                            "</span></div>" +
                                            "<div class='col-11'>" +
                                            "<div style='display: flex; justify-content: space-between'>" +

                                            "<div style='display: flex; flex-direction: row'>" +
                                            "<div style='margin-right: 10px;'>" +
                                            "<strong>" + comment.calComUserId + "</strong>" +
                                            "</div>" +
                                            "<div class='' style='font-size: 14px; padding-top: 3px; color: #AAAAAA;'>"+ comment.calComRegisterDateStr +"</div>" +
                                            "</div>" +

                                            "</div>" +

                                            "<div style='padding-top: 8px; font-size: 15px;'>" + comment.calComContent + "</div>" +
                                            "</div>" +
                                            "</div>" +
                                            "<hr style='color: rgb(126,125,125);'>" +
                                            "</li>");
                                    }
                                });

                                $($("#comment_list_div")).append(ul);


                                // console.log($("#comment_list_div"));
                            }


                        })


                        $('.js-show-schedule').addClass('show-header-cart');
                    },


                });
                calendarObj = calendar;
                calendar.render();

            });

            request.fail(function (jqXHR, textStatus) {
                //alert("Request failed : " + textStatus);
            });


        });

    }); /////////////////////////////// E N D ///////////////////////////////


    function closeModal() {
        $('#addScheduleModal').hide();
        $('#calendarForm')[0].reset();
        // $(".btn-close").click();
        // document.getElementById("mapImagee").remove();
        document.getElementById('imgDiv').style.display = 'none';
    }

    var fpStart = flatpickr(".startCalDate", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
    });
    var fpEnd = flatpickr(".endCalDate", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
    });

    function setDateTime(arg) {//일정 드래그 후, start end에 값 세팅하는 메서드
        var end = new Date(new Date(arg.endStr).getTime() - 86400000);
        var endDate = dateFormat(end).toString();

        var start = new Date(arg.startStr);
        var startDate = dateFormat(start).toString();
        fpStart.setDate(startDate);
        fpEnd.setDate(endDate);
    }

    function dateFormat(date) {//yyyy-mm-dd 00:00(현재시간) 형식으로 반환하는 메서드
        let month = date.getMonth() + 1;
        let day = date.getDate();

        month = month >= 10 ? month : '0' + month;
        day = day >= 10 ? day : '0' + day;

        var today = new Date();
        var hours = ('0' + today.getHours()).slice(-2);
        var minutes = ('0' + today.getMinutes()).slice(-2);

        return date.getFullYear() + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
    }

    // 사이드 스케줄
    function closeTab() {
        $('.js-show-schedule').removeClass('show-header-cart');
    }


    // Next버튼을 누르면 달력 첫 번째, 마지막 날짜
    $(document).on("click", "#calendar .fc-prev-button", function () {
        console.log("pressed prev button");
        var calObj = calendarObj;
        console.log(calObj.view.activeStart);
        console.log(calObj.view.activeEnd);
    });

    // Prev버튼을 누르면 달력 첫 번째, 마지막 날짜
    $(document).on("click", "#calendar .fc-next-button", function () {
        console.log("pressed next button");
        var calObj = calendarObj;
        console.log(calObj.view.activeStart);
        console.log(calObj.view.activeEnd);
    });


    $(function () {
        $('#submitCalSchedule').on("click", function () {
            // var form1 = $("#frm").serialize();

            // var form1 = $("#calendarForm").serializeObject();
            var form1 = $("#calendarForm").serializeArray();
            console.log("여러분 : " + JSON.stringify(form1));

            console.log("폼입니다 : " + form1);
            // console.log("폼입니다 : " + form1.scheduleTitle);
            // console.log("폼입니다 : " + form1.startDate);
            // console.log("폼입니다 : " + form1.endDate);
            //
            // console.log("폼입니다 : " + form1.writeScheduleContent);
            console.log("폼입니다다다다 : " + form1.addressInputId);
            console.log("폼입니다다다닫 : " + form1.mapImage);

            var imageUrl = $('#mapImagee').attr('src');
            console.log("hogggg  : " + imageUrl);
            // form1.mapImage = imageUrl;

            form1.push({name : "mapImage" , value : imageUrl});

            var projectIdd = document.getElementById("projectIdId").value;
            form1.push({name : "projectIdd" , value : projectIdd});

            dataType: 'json',
            $.ajax({
                type: "post",
                url: "/registerSchedule",
                data: form1,
                success: function (data) {
                    location.reload();
                },
                error: function (request, status, error) {
                    console.log("통신 실패");
                    console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);

                }
            });
        });
    });


     // 수정
    $(function () {
        $('#modifySubmitCalShedule').on("click", function () {
            var form2 = $("#modifyCalendarForm").serializeArray();

            var imageUrl = $('#mapImageeM').attr('src');
            console.log("수정src :: " + imageUrl);
            form2.push({name : "mapImage" , value : imageUrl});
            var calId = document.getElementById("slideCalendarIdId").value;
            form2.push({name : "calId" , value : calId});
            var pjIdId = document.getElementById("projectIdId").value;
            form2.push({name : "projectId" , value : pjIdId});

            var address = document.getElementById("modifyAddressInputId").value;
            form2.push({name : "address" , value : address});

            console.log("수정씨 : " + JSON.stringify(form2));


            $.ajax({
                type: "post",
                url: "/modifySchedule",
                data: form2,
                success: function (data) {
                    location.reload();
                },
                error: function (request, status, error) {
                    console.log("통신 실패");
                    console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);

                }
            });
        });
    });


    jQuery.fn.serializeObject = function () {//form.serialize -> json형식으로 변환해주는 메서드
        var obj = null;
        try {
            if (this[0].tagName && this[0].tagName.toUpperCase() == "FORM") {
                var arr = this.serializeArray();
                if (arr) {
                    obj = {};
                    jQuery.each(arr, function () {
                        obj[this.name] = this.value;
                    });
                }
            }
        } catch (e) {
            alert(e.message);
        }
        return obj;
    };
</script>



<!--                comment modify                -->
<script>
    function modifyCalComment(commentId, projectId, calendarId){
        var cmtId = document.getElementById("tmptmp"+commentId);
        cmtId.style.display = "none";

        var col11 = document.getElementById("comment"+commentId);
        var commment = document.getElementById("cmtcmt"+commentId);
        commenttt =  commment.innerText;

        const w = "non";

        $(col11).append(
            "<div class='comment-container' style='padding: 0; width: 100%;'>" +
            "<input type='text' class='commentInput' id='commentModifyId"+commentId+"'  style='padding: 0; !important; width: 100%;' placeholder='댓글을 입력은 Enter 입니다.' value='"+commenttt+"' aria-label='' aria-describedby='button-addon2' onKeyUp='if(window.event.keyCode==13){cmtModifyMethod(" + commentId + ","+ projectId + ","+ calendarId +",\"" + w +"\")}'/>" +
            "</div>"
        );
    }

    function modifyCalComment2(commentId, projectId, calendarId){
        var cmtId = document.getElementById("2tmptmp"+commentId);
        cmtId.style.display = "none";

        var col11 = document.getElementById("11col"+commentId);
        var commment = document.getElementById("2cmtcmt"+commentId);
        commenttt =  commment.innerText;

        const w = "oui";

        $(col11).append(
            "<div class='comment-container' style='padding: 0; width: 100%;'>" +
            "<input type='text' class='commentInput' id='2commentModifyId"+commentId+"' style='padding: 0; !important; width: 100%;' placeholder='댓글을 입력은 Enter 입니다.' value='"+commenttt+"' aria-label='' aria-describedby='button-addon2' onKeyUp='if(window.event.keyCode==13){cmtModifyMethod(" + commentId + ","+ projectId + ","+ calendarId +",\"" + w +"\")}'/>" +
            "</div>"
        );
    }

    function cmtModifyMethod(commentId, projectId, calendarId, isNew){
        var commentVal
        if(isNew == 'non') {
            commentVal = document.getElementById("commentModifyId"+commentId).value;
        } else {
            commentVal = document.getElementById("2commentModifyId"+commentId).value;
        }

        commentData = {"projectId" : projectId,
            "calendarId" : calendarId,
            "commentId" : commentId,
            "commentVal" : commentVal
            };

        $.ajax({
            url: "/modifyComment",
            type: "POST",
            data: commentData,
            success: function () {
                if(isNew == 'non') {
                    var cmtId = document.getElementById("tmptmp"+commentId);
                    cmtId.style.display = "block";

                    var commentModifyIdTag = document.getElementById("commentModifyId"+commentId);
                    commentModifyIdTag.style.display = "none";

                    $("#cmtcmt"+commentId).text(commentVal);
                } else {
                    var cmtId2 = document.getElementById("2tmptmp"+commentId);
                    cmtId2.style.display = "block";

                    var commentModifyIdTag2 = document.getElementById("2commentModifyId"+commentId);
                    commentModifyIdTag2.style.display = "none";

                    $("#2cmtcmt"+commentId).text(commentVal);

                }
            },
            error: function (request, status, error) {
                console.log("통신 실패");
                console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);
            }
        });

    }


</script>



<!--            google map api          -->
<script>
    $('#addressInputId').on("input", function() {
        var val = $('#addressInputId').val().trim();
        // console.log("입력하고 있는 값 : " + val.trim() );
        if(val == ""){
            console.log("Empty String. its gonna be removed");
            document.getElementById("imgDiv").style.display = "none";
        }
    });

    $('#modifyAddressInputId').on("input", function() {
        var val = $('#modifyAddressInputId').val().trim();
        // console.log("입력하고 있는 값 : " + val.trim() );

        if(val == ""){
            console.log("Modify Empty String.");
            document.getElementById("modifyImgDiv").style.display = "none";
        }
    });


    $(document).ready(function() {
        var autocomplete = new google.maps.places.Autocomplete(document.getElementById('addressInputId'));

        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var selectedPlace = autocomplete.getPlace();

            var selectedAddress = selectedPlace.formatted_address;
            console.log('클릭 주소 :', selectedAddress);
            if(selectedAddress != "undefined") {
                getLngLat(selectedAddress, 'register');
            } else {
                console.log('언디파인드')
            }
        });
    });

    $(document).ready(function() {
        var autocomplete = new google.maps.places.Autocomplete(document.getElementById('modifyAddressInputId'));

        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var selectedPlace = autocomplete.getPlace();

            var selectedAddress = selectedPlace.formatted_address;
            console.log('클릭 주소 :', selectedAddress);
            if(selectedAddress != "undefined") {
                getLngLat(selectedAddress, 'modify');
            } else {
                console.log('언디파인드')
            }
        });
    });


    function enterAddress(isNew){ //엔터 누룰시 동작되는 메서드
        var inputAddress;
        if(isNew == 'register') {
            inputAddress = document.getElementById('addressInputId').value;
        } else if(isNew == 'modify') {
            inputAddress = document.getElementById('modifyAddressInputId').value;
        }

        console.log("엔터 주소 : " + inputAddress);
        getLngLat(inputAddress, isNew);
    }

    function getLngLat(rawAddress, isNew){
        console.log("가공되지 않은 주소 : " + rawAddress);

        var geocoder;
        var map;
        geocoder = new google.maps.Geocoder();

        geocoder.geocode({'address': rawAddress}, function (results, status) {


            if (status == 'OK') {
                console.log('this is OK');
                console.log("위도 : " + results[0].geometry.location.lat());
                console.log("경도 : " + results[0].geometry.location.lng());

                const apiKey = 'AIzaSyABN0ndYhxNu4zHlvEfKi_r42aSUMeVUaI';

                const latitude = results[0].geometry.location.lat()
                const longitude = results[0].geometry.location.lng()

                // Set the map center and other parameters
                const mapCenter = `center=${latitude},${longitude}`;
                const mapZoom = 'zoom=14'; // Optional: Specify the zoom level

                const mapMarkers = `markers=color:red%7Clabel:%7C${latitude}, ${longitude}`;

                const imageUrl = `https://maps.googleapis.com/maps/api/staticmap?${mapCenter}&${mapZoom}&size=646x220&${mapMarkers}&key=${apiKey}`;

                if(isNew == 'register') {
                    document.getElementById("mapImagee").src = imageUrl;
                    document.getElementById('imgDiv').style.display = 'block';
                } else if(isNew == 'modify') {
                    document.getElementById("mapImageeM").src = imageUrl;
                    document.getElementById('modifyImgDiv').style.display = 'block';
                }

                // var ads = addressLogic(latitude, longitude);
                // console.log(addressLogic(latitude, longitude))
                // console.log("ads : " + ads);

            } else {
                console.log("!ERROR! : " + status);
            }
        });
    }
</script>




<!--            댓글          -->
<script th:inline="javascript">

    function sendComment() {
        const commentInput = document.getElementById('post_comment_input');
        const projectIdId = document.getElementById('projectIdId').value;
        const loginUserId = document.getElementById("logInnn").value;
        const logInUsername = document.getElementById("logInnname").value;

        let comData = {
            "comment": commentInput.value,
            "projectIdId": projectIdId,
            "calId": Obj.id,
            "loginUserId" : loginUserId
        };


        $.ajax({
            type: "post",
            url: "/insertCalComment",
            data: comData,
            success: function (data) {
                // 댓글 입력시 요소 생성
                console.log("받은것은 : "+ data.commentId);
                console.log("받은것은 : "+ data.calComProjectId);
                console.log("받은것은 : "+ data.calComCalId);
                console.log("받은것은 : "+ data.commentId);
                console.log("받은것은 : " + data.registerDate);
                const addNewComment = () => {
                    // const newCommentLocation = document.getElementsByClassName('comment_list_ul')[0];
                    const newCommentLocation = document.getElementById("comment_list_ul");
                    const newComment = document.createElement('li');
                    newComment.id = data.commentId;

                    newComment.innerHTML = `
                        <div style="display: flex;" class="m-3">
                        <div class="col-1">
                            <span class="thumbnail size40 radius16" style="background-image: url(/img/penguin.jpg)"></span>
                        </div>

                        <div class="col-11" id="11col${data.commentId}">
                        <div id="2tmptmp${data.commentId}">
                            <div style="display: flex; justify-content: space-between">

                                <div style="display: flex; flex-direction: row">
                                    <div class="" style="margin-right: 10px;"><strong>${data.username}</strong></div>
                                    <div class="" style="font-size: 14px; padding-top: 3px; color: #AAAAAA;">${data.registerDateStr}
                                    </div>
                                </div>

                                <div style="display: flex;flex-direction: row">


                                    <div class="" style="margin-right: 5px"><!--수정-->
                                        <a class="bi bi-pencil-square" type="button" style="color: #AAAAAA;" href="#"
                                           onclick="modifyCalComment2(${data.commentId}, ${data.projectIdId}, ${data.calendarId})"></a>
                                    </div>
                                    <div class=""><!--삭제-->
                                        <a class="bi bi-trash3" type="button" style="color: #AAAAAA;" href="#"
                                           onclick="deleteCalComment(${data.commentId}, ${data.projectIdId}, ${data.calendarId})"></a>
                                    </div>
                                </div>
                            </div>

                            <div id="2cmtcmt${data.commentId}" style="padding-top: 8px; font-size: 15px;">${commentInput.value}</div>
                            </div>

                        </div>
                    </div>
                    <hr style="color: rgb(126,125,125);">

    `;

                    // newComment.innerHTML += `<!--<h5>이런식으로 추가가 가능합니다.</h5>-->`;


                    newCommentLocation.appendChild(newComment);
                    commentInput.value = '';
                }


                if (commentInput.value) {
                    addNewComment();
                } else {
                    alert('댓글이 입력되지 않았습니다 😳');
                }


            },
            error: function (request, status, error) {
                console.log("통신 실패");
                console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);
            }
        });


    }


    function method() {
        alert("새로운 댓글에 동작되는 메서드 입니다.");
    }

    function deleteCalComment(commentId, projectId, calendarId ) {
        console.log("댓글 번호 : " + commentId);
        console.log("플젝 번호 : " + projectId)
        console.log("일정 번호 : " + calendarId)
        let data = {"commentId": commentId,
                    "projectIdId" : projectId,
                    "calendarId" : calendarId
        };
        $.ajax({
            type: "post",
            url: "/deleteCalComment",
            data: data,
            success: function (data) {
                document.getElementById(commentId).remove();
            },
            error: function (request, status, error) {
                console.log("통신 실패");
                console.log("code:" + request.status + "\n" + "message : " + request.responseText + "\n" + "error : " + error);

            }
        });
    }

</script>



</div>
</html>
